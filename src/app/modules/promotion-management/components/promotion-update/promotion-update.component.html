<div class="card-body">
    <form [formGroup]="promotionForm">
        <div class="col-md-12" *ngIf="!imageUploadSuccess">
            <input type="file" multiple accept='image/*' (change)="onFileChange($event)">
        </div>
        <br *ngIf="!imageUploadSuccess" />
        <div class="col-md-12" *ngIf="imageUploadSuccess">
            <mat-form-field class="example-full-width">
                <input matInput placeholder="Enter Image URL" disabled required formControlName="promotionImage">
            </mat-form-field>
        </div>
        <div class="col-md-12">
            <mat-form-field class="example-full-width">
                <input matInput placeholder="Enter Promotion Name" formControlName="description" required>
            </mat-form-field>
        </div>
        <div class="col-md-12">
            <mat-form-field appearance="fill">
                <mat-label>Start Date</mat-label>
                <input matInput [matDatepicker]="startPicker" formControlName="startDate">
                <mat-datepicker-toggle matSuffix [for]="startPicker"></mat-datepicker-toggle>
                <mat-datepicker #startPicker></mat-datepicker>
            </mat-form-field>
        </div>
        <div class="col-md-12">
            <mat-form-field appearance="fill">
                <mat-label>End Date</mat-label>
                <input matInput [matDatepicker]="endPicker" formControlName="endDate">
                <mat-datepicker-toggle matSuffix [for]="endPicker"></mat-datepicker-toggle>
                <mat-datepicker #endPicker></mat-datepicker>
            </mat-form-field>
        </div>
        <div class="col-md-12">
            <div class="row">
                <div class="details col-md-10">
                    <mat-label>Products</mat-label>
                    <ol class="ol-side-margin" *ngIf="promotionLines?.length != 0">
                        <li *ngFor="let item of promotionLines; let i = index">
                            <div class="row">
                                <div class="col-md-9">
                                    <p class="link-access" (click)="getPromotionLines(i)">{{item?.product?.name}}</p>
                                </div>
                                <div class="col-md-1">
                                    <i class="material-icons btn-close pull-right"
                                       (click)="onRemoveLines(i)">close</i>
                                </div>
                            </div>
                        </li>
                    </ol>
                </div>
                <div class="col-md-2">
                    <button class="btn btn-danger pull-right" (click)="openModal()">Add</button>
                </div>
            </div>
        </div>
        <div class="col-md-12">
            <button mat-raised-button class="btn btn-primary pull-right" *ngIf="!promotionBlock"
                    [disabled]="promotionForm.invalid" (click)="onUpdatePromotion()">Update
                Promotion</button>
            <app-loading-ui *ngIf="promotionBlock" [block]='promotionBlock'></app-loading-ui>
        </div>
    </form>
</div>

<aside class="aside-right-description" [ngClass]="{'open': display}">
    <div *ngIf='display'>
        <div class="modal-header">
            <h4 *ngIf="!isUpdate">Create Promotion Line</h4>
            <h4 *ngIf="isUpdate">Update Promotion Line</h4>
            <i class="material-icons btn-close" (click)="closeModal()">close</i>
        </div>
        <div class="modal-body">
            <app-loading-ui *ngIf="productBlock" [block]="productBlock"></app-loading-ui>
            <p *ngIf="productBlock" style="text-align: center;">Loading Products. Please Wait! ...</p>
            <form *ngIf="!productBlock" [formGroup]="promotionLineForm">
                <div class="col-md-12">
                    <ng-select formControlName="productId" placeholder="Select Product" (change)="onChangeProduct()">
                        <ng-option *ngFor="let product of promotionProduct" [value]="product.id">{{product.name}}</ng-option>
                     </ng-select>
                </div>
                <div class="col-md-12">
                    <mat-form-field class="example-full-width">
                        <mat-label>Select Description</mat-label>
                        <select matNativeControl formControlName="descriptionId" (change)="onChangeDescription()"
                                required>
                            <option value="">None</option>
                            <option *ngFor="let description of descriptionLines" [value]="description.id">
                                {{description.name}}</option>
                        </select>
                    </mat-form-field>
                </div>
                <input type="text" formControlName="id" hidden/>
                <input type="text" formControlName="promotionId" hidden/>
                <div class="col-md-12">
                    <mat-form-field class="example-full-width">
                        <input matInput type="number" class="example-right-align" placeholder="Enter Quantity" required
                               formControlName="quantity">
                    </mat-form-field>
                </div>
                <div class="col-md-12">
                    <mat-form-field class="example-full-width">
                        <input matInput type="number" class="example-right-align" disabled
                               placeholder="Enter Unit Price" required formControlName="unitPrice">
                        <span matPrefix>LKR&nbsp;</span>
                    </mat-form-field>
                </div>
                <div class="col-md-12">
                    <mat-form-field class="example-full-width">
                        <input matInput type="number" class="example-right-align" placeholder="Enter Discount Price"
                               required formControlName="discountPrice">
                        <span matPrefix>LKR&nbsp;</span>
                    </mat-form-field>
                </div>
                <div class="col-md-12">
                    <button class="btn btn-danger pull-right" *ngIf="!isUpdate" [disabled]="promotionLineForm.invalid"
                            (click)="onSaveLines()">Add</button>
                    <button class="btn btn-danger pull-right" *ngIf="isUpdate" [disabled]="promotionLineForm.invalid"
                            (click)="onUpdateLines()">Update</button>
                </div>
            </form>
        </div>
    </div>
</aside>


<aside class="aside-right-preview" [ngClass]="{'open': previewDisplay}">
    <div *ngIf='previewDisplay'>
        <div class="modal-header">
            <h4>Image Preview</h4>
            <i class="material-icons btn-close" (click)="closePreviewModal()">close</i>
        </div>
        <div class="modal-body">
            <img *ngIf="filePath != null" [src]="filePath" width="100%" height="100%" />
            <img *ngIf="filePath == null" [src]="promotion.promotionImage" width="100%" height="100%" />
            <app-loading-ui *ngIf="imageBlock" [block]="imageBlock"></app-loading-ui>
            <button *ngIf="!imageBlock && !imageUploadSuccess" class="btn btn-danger"
                    (click)="uploadImage()">Save</button>
            <button *ngIf="!imageBlock && imageUploadSuccess" class="btn btn-danger"
                    (click)="removeImage()">Remove</button>
        </div>
    </div>
</aside>

<aside class="aside-right-preview-description" [ngClass]="{'open': previewDisplayDescription}">
    <div *ngIf='previewDisplayDescription'>
        <div class="modal-header">
            <h4>Image Preview</h4>
            <i class="material-icons btn-close" (click)="closePreviewDesModal()">close</i>
        </div>
        <div class="modal-body">
            <div *ngFor="let item of descriptionLines">
                <img [src]="item?.imageUrl" alt="Couldn't access the image" width="100%" height="100%" />
                <p> {{item?.name}} </p>
            </div>
        </div>
    </div>
</aside>
